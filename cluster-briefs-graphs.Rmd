---
title: "Cluster Briefs Graphs"
author: "Abigail Freed"
date: "6/21/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r importing spreadsheet & packages, warning = FALSE, message = FALSE}
library(readxl)
library(purrr)
library(tidyverse)
library(reshape2)
library(ggridges)
library(RColorBrewer)

file_name <- "Projections_2018-28_PRIME_2021-05-20.xlsx"

nonduplicated <- read_xlsx(path=file_name, 
                  sheet = "Nonduplicated",
                  col_types = c(rep("text", 13), rep("numeric",8)), na = ".")

fix_names <- function(x){
  x <- str_replace_all(string = x, pattern = "[ -]", replacement = "_")
  x <- str_to_lower(x)
  x <- str_remove_all(x, pattern = "2018_")
  x <- str_remove_all(x, pattern = "2028_")
  x <- str_remove_all(x, pattern = "28_")
  
  return(x)
}

nonduplicated <- nonduplicated %>%
  rename_with(.fn = fix_names) %>% 
  rename(fraction_change = percent_change) %>%
  rename(fraction_change_us = percent_change_us)
```

```{r 1st plot, warning=FALSE}

# expl = names(nonduplicated)[4]
# expl = set_names(expl)
# 
# education_level = function(x, y) {
#      ggplot(nonduplicated %>% filter(!is.na(predominant_education_level), cluster == x), aes(x = .data[[x]], y = .data[[y]])) +
#           geom_col(position = "fill", na.rm = TRUE) + theme(axis.text.x=element_text(angle = 45, h = 1))
# }
# edu_plots = map(expl, ~education_level(.x, "projection") )
# edu_plots


nonduplicated$predominant_education_level <- factor(nonduplicated$predominant_education_level,levels = c("Graduate / Professional Degree", "Bachelor's Degree", "Some College / Associate Degree", "HS Diploma"))

#my_colors <- c("navy", "#046C9A", "#ABDDDE", "#D69C4E")
my_colors <- colorRampPalette(brewer.pal(9,"Blues"))(4)
names(my_colors) <- levels(nonduplicated$predominant_education_level)

nonduplicated <- nonduplicated %>% mutate(pathway_for_labels = str_replace_all(pathway, " ", "\n"))
nonduplicated <- nonduplicated %>% mutate(pathway_for_labels = str_replace_all(pathway_for_labels, "Transp", "Trans-\np"))
nonduplicated <- nonduplicated %>% mutate(pathway_for_labels = str_replace_all(pathway_for_labels, "Tele", "Tele-\n"))
nonduplicated <- nonduplicated %>% mutate(pathway_for_labels = str_replace_all(pathway_for_labels, "/", "/\n"))

nonduplicated <- nonduplicated %>% mutate(pathway_for_labels_change = paste(pathway_for_labels,"\n", "(", round(fraction_change*100, 2), "%", ")", sep = ""))

nonduplicated <- mutate(nonduplicated, edu_weighting = ifelse(predominant_education_level == "HS Diploma", 12, ifelse(predominant_education_level == "Some College / Associate Degree", 14, ifelse(predominant_education_level == "Bachelor's Degree",16, ifelse(predominant_education_level == "Graduate / Professional Degree", 18, NA)))))

nonduplicated %>% filter(!is.na(edu_weighting)) %>% 
  select(cluster, pathway, edu_weighting) %>% 
  group_by(pathway) %>% 
  summarise(mean_weight = mean(edu_weighting))

# ##Agriculture Cluster 
# 
# nonduplicated %>% filter(cluster == "Agriculture, Food, and Natural Resources", 
#                          !is.na(predominant_education_level)) %>% ggplot(aes(pathway_for_labels, projection, fill = predominant_education_level)) + 
#   geom_col(position = "fill") + 
#   theme(panel.grid = element_blank(),
#         axis.title = element_blank(),
#         axis.text.y = element_blank(),
#         axis.ticks.y = element_blank(), 
#         legend.title = element_blank()) + 
#   scale_fill_manual(values = my_colors) 
# 
# ## Architecture and Construction Cluster
# 
# nonduplicated %>% filter(cluster == "Architecture and Construction", 
#                          !is.na(predominant_education_level)) %>% ggplot(aes(pathway_for_labels, projection, fill = predominant_education_level)) + 
#   geom_col(position = "fill") + 
#   theme(panel.grid = element_blank(),
#         axis.title = element_blank(),
#         axis.text.y = element_blank(),
#         axis.ticks.y = element_blank(), 
#         legend.title = element_blank()) + 
#   scale_fill_manual(values = my_colors) 
# 
# ## Arts Audio/Video Technology, and Communications
# 
# nonduplicated %>% filter(cluster == "Arts, Audio/Video Technology, and Communications", 
#                          !is.na(predominant_education_level)) %>% ggplot(aes(pathway_for_labels, projection, fill = predominant_education_level)) + 
#   geom_col(position = "fill") + 
#   theme(panel.grid = element_blank(),
#         axis.title = element_blank(),
#         axis.text.y = element_blank(),
#         axis.ticks.y = element_blank(), 
#         legend.title = element_blank()) + 
#   scale_fill_manual(values = my_colors) 
# 
# # Business Management and Administration Cluster
# 
# nonduplicated %>% filter(cluster == "Business Management and Administration", 
#                          !is.na(predominant_education_level)) %>% ggplot(aes(pathway_for_labels, projection, fill = predominant_education_level)) + 
#   geom_col(position = "fill") + 
#   theme(panel.grid = element_blank(),
#         axis.title = element_blank(),
#         axis.text.y = element_blank(),
#         axis.ticks.y = element_blank(), 
#         legend.title = element_blank()) + 
#   scale_fill_manual(values = my_colors) 
# 
# # Education and Training Cluster
# 
# nonduplicated %>% filter(cluster == "Education and Training", 
#                          !is.na(predominant_education_level)) %>% ggplot(aes(pathway_for_labels, projection, fill = predominant_education_level)) + 
#   geom_col(position = "fill") + 
#   theme(panel.grid = element_blank(),
#         axis.title = element_blank(),
#         axis.text.y = element_blank(),
#         axis.ticks.y = element_blank(), 
#         legend.title = element_blank()) + 
#   scale_fill_manual(values = my_colors)
# # Finance Cluster 
# 
# nonduplicated %>% filter(cluster == "Finance", 
#                          !is.na(predominant_education_level)) %>% ggplot(aes(pathway_for_labels, projection, fill = predominant_education_level)) + 
#   geom_col(position = "fill") + 
#   theme(panel.grid = element_blank(),
#         axis.title = element_blank(),
#         axis.text.y = element_blank(),
#         axis.ticks.y = element_blank(), 
#         legend.title = element_blank()) + 
#   scale_fill_manual(values = my_colors)
#   
# #  Government and Public Adminstration Cluster 
# 
# nonduplicated %>% filter(cluster == "Government and Public Adminstration", 
#                          !is.na(predominant_education_level)) %>% ggplot(aes(pathway_for_labels, projection, fill = predominant_education_level)) + 
#   geom_col(position = "fill") + 
#   theme(panel.grid = element_blank(),
#         axis.title = element_blank(),
#         axis.text.y = element_blank(),
#         axis.ticks.y = element_blank(), 
#         legend.title = element_blank()) + 
#   scale_fill_manual(values = my_colors) 
# 
# # Health Science Cluster
# 
# nonduplicated %>% filter(cluster == "Health Science", 
#                          !is.na(predominant_education_level)) %>% ggplot(aes(pathway_for_labels, projection, fill = predominant_education_level)) + 
#   geom_col(position = "fill") + 
#   theme(panel.grid = element_blank(),
#         axis.title = element_blank(),
#         axis.text.y = element_blank(),
#         axis.ticks.y = element_blank(), 
#         legend.title = element_blank()) + 
#   scale_fill_manual(values = my_colors) 
# 
# # Hospitality and Tourism Cluster
# 
# nonduplicated %>% filter(cluster == "Hospitality and Tourism", 
#                          !is.na(predominant_education_level)) %>% ggplot(aes(pathway_for_labels, projection, fill = predominant_education_level)) + 
#   geom_col(position = "fill") + 
#   theme(panel.grid = element_blank(),
#         axis.title = element_blank(),
#         axis.text.y = element_blank(),
#         axis.ticks.y = element_blank(), 
#         legend.title = element_blank()) + 
#   scale_fill_manual(values = my_colors) 
# 
# # Human Services Cluster
# 
# nonduplicated %>% filter(cluster == "Human Services", 
#                          !is.na(predominant_education_level)) %>% ggplot(aes(pathway_for_labels, projection, fill = predominant_education_level)) + 
#   geom_col(position = "fill") + 
#   theme(panel.grid = element_blank(),
#         axis.title = element_blank(),
#         axis.text.y = element_blank(),
#         axis.ticks.y = element_blank(), 
#         legend.title = element_blank()) + 
#   scale_fill_manual(values = my_colors) 
# 
# #Information Technology Cluster
# 
# nonduplicated %>% filter(cluster == "Information Technology", 
#                          !is.na(predominant_education_level)) %>% ggplot(aes(pathway_for_labels, projection, fill = predominant_education_level)) + 
#   geom_col(position = "fill") + 
#   theme(panel.grid = element_blank(),
#         axis.title = element_blank(),
#         axis.text.y = element_blank(),
#         axis.ticks.y = element_blank(), 
#         legend.title = element_blank()) + 
#   scale_fill_manual(values = my_colors)
# 
# #Law, Public Safety, Corrections, and Security Cluster
# 
# nonduplicated %>% filter(cluster == "Law, Public Safety, Corrections, and Security", 
#                          !is.na(predominant_education_level)) %>% ggplot(aes(pathway_for_labels, projection, fill = predominant_education_level)) + 
#   geom_col(position = "fill") + 
#   theme(panel.grid = element_blank(),
#         axis.title = element_blank(),
#         axis.text.y = element_blank(),
#         axis.ticks.y = element_blank(), 
#         legend.title = element_blank()) + 
#   scale_fill_manual(values = my_colors)
# 
# # Manufacturing Cluster
# 
# nonduplicated %>% filter(cluster == "Manufacturing", 
#                          !is.na(predominant_education_level)) %>% ggplot(aes(pathway_for_labels, projection, fill = predominant_education_level)) + 
#   geom_col(position = "fill") + 
#   theme(panel.grid = element_blank(),
#         axis.title = element_blank(),
#         axis.text.y = element_blank(),
#         axis.ticks.y = element_blank(), 
#         legend.title = element_blank()) + 
#   scale_fill_manual(values = my_colors) 
# 
# # Marketing Cluster
# 
# nonduplicated %>% filter(cluster == "Marketing", 
#                          !is.na(predominant_education_level)) %>% ggplot(aes(pathway_for_labels, projection, fill = predominant_education_level)) + 
#   geom_col(position = "fill") + 
#   theme(panel.grid = element_blank(),
#         axis.title = element_blank(),
#         axis.text.y = element_blank(),
#         axis.ticks.y = element_blank(), 
#         legend.title = element_blank()) + 
#   scale_fill_manual(values = my_colors)
# 
# # Science, Technology, Engineering, and Mathematics Cluster
# 
# nonduplicated %>% filter(cluster == "Science, Technology, Engineering, and Mathematics", 
#                          !is.na(predominant_education_level)) %>% ggplot(aes(pathway_for_labels, projection, fill = predominant_education_level)) + 
#   geom_col(position = "fill") + 
#   theme(panel.grid = element_blank(),
#         axis.title = element_blank(),
#         axis.text.y = element_blank(),
#         axis.ticks.y = element_blank(), 
#         legend.title = element_blank()) + 
#   scale_fill_manual(values = my_colors) 
# 
# #Transportation, Distribution, and Logistics Cluster
# 
# nonduplicated %>% filter(cluster == "Transportation, Distribution, and Logistics", 
#                          !is.na(predominant_education_level)) %>% ggplot(aes(pathway_for_labels, projection, fill = predominant_education_level)) + 
#   geom_col(position = "fill") + 
#   theme(panel.grid = element_blank(),
#         axis.title = element_blank(),
#         axis.text.y = element_blank(),
#         axis.ticks.y = element_blank(), 
#         legend.title = element_blank()) + 
#   scale_fill_manual(values = my_colors) 
# 
# 
# nonduplicated %>% filter(cluster == "Energy", 
#                          !is.na(predominant_education_level)) %>% ggplot(aes(pathway_for_labels, projection, fill = predominant_education_level)) + 
#   geom_col(position = "fill") + 
#   theme(panel.grid = element_blank(),
#         axis.title = element_blank(),
#         axis.text.y = element_blank(),
#         axis.ticks.y = element_blank(), 
#         legend.title = element_blank()) + 
#   scale_fill_manual(values = my_colors) 
# 
# 
# graph1 <- function(x) {
#   
#   cluster_graph <- nonduplicated %>% filter(cluster == x, 
#                          !is.na(predominant_education_level)) %>% ggplot(aes(pathway_for_labels, projection, fill = predominant_education_level)) + 
#   geom_col(position = "fill") + 
#   theme(panel.grid = element_blank(),
#         axis.title = element_blank(),
#         axis.text.y = element_blank(),
#         axis.ticks.y = element_blank(), 
#         legend.title = element_blank()) + 
#   scale_fill_manual(values = my_colors) 
#   
#   return(cluster_graph)
# }

cluster_list <- unique(nonduplicated$cluster, fromLast = TRUE) 

for (x in cluster_list){
   edu_graph <- nonduplicated %>% filter(cluster == x, 
                         !is.na(predominant_education_level)) %>% ggplot(aes(pathway_for_labels, projection, fill = predominant_education_level)) + 
  geom_col(position = "fill") + 
  theme(panel.grid = element_blank(),
        axis.title = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank(), 
        legend.title = element_blank()) + 
  scale_fill_manual(values = my_colors) 
  
  print(edu_graph)
}
```

```{r 2nd graph showing added jobs over decade}

my_colors2 <- c("darkgrey", "#046C9A")
jobs_labels <- c("2018 Estimate", "2028 Estimate")
text_size <- 2.5
text_width <- 0.9
text_vertical <- -0.25

# for (x in cluster_list){
#   linked_pathway <- nonduplicated %>% 
#   filter(!is.na(pathway), is.na(soc_title),cluster == x) %>% 
#   select(pathway_for_labels_change, estimate, projection)
#   
#   linked_pathway <- melt(ag_linked_pathway, id = "pathway_for_labels_change") 
# 
#   employment_graph <- ggplot(linked_pathway, aes(pathway_for_labels_change, value, fill = variable)) + 
#   geom_bar(stat="identity",position="dodge") + 
#   ylab("Number of Jobs") +  
#   theme(legend.title = element_blank(),
#         axis.title.x = element_blank(),
#         panel.grid.major.x = element_blank()) + 
#   scale_fill_manual(values = my_colors2, 
#                     labels = jobs_labels) +
#   geom_text(aes(label = value), size = text_size, position = position_dodge(width=text_width), vjust = text_vertical)
# print(employment_graph)
# }

# Agriculture, Food, and Natural Resources

ag_linked_pathway <- nonduplicated %>%
  filter(!is.na(pathway), is.na(soc_title),cluster == "Agriculture, Food, and Natural Resources") %>%
  select(pathway_for_labels_change, estimate, projection)
ag_linked_pathway <- melt(ag_linked_pathway, id = "pathway_for_labels_change")

ggplot(ag_linked_pathway, aes(pathway_for_labels_change, value, fill = variable)) +
  geom_bar(stat="identity",position="dodge") +
  ylab("Number of Jobs") +
  theme(legend.title = element_blank(),
        axis.title.x = element_blank(),
        panel.grid.major.x = element_blank()) +
  scale_fill_manual(values = my_colors2,
                    labels = jobs_labels) +
  geom_text(aes(label = value), size = text_size, position = position_dodge(width=text_width), vjust = text_vertical)

# Architecture and Construction

arch_linked_pathway <- nonduplicated %>%
  filter(!is.na(pathway), is.na(soc_title), cluster == "Architecture and Construction") %>%
  select(pathway_for_labels_change, estimate, projection)
arch_linked_pathway <- melt(arch_linked_pathway, id = "pathway_for_labels_change")

ggplot(arch_linked_pathway, aes(pathway_for_labels_change, value, fill =variable)) +
  geom_bar(stat="identity",position="dodge") +
  ylab("Number of Jobs") +
  theme(legend.title = element_blank(),
        axis.title.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank()) +
  scale_fill_manual(values = my_colors2,
                    labels = jobs_labels) +
  geom_text(aes(label = value), size = text_size, position = position_dodge(width=text_width), vjust = text_vertical)

# Arts, Audio/Video Technology, and Communications

arts_linked_pathway <- nonduplicated %>%
  filter(!is.na(pathway), is.na(soc_title), cluster == "Arts, Audio/Video Technology, and Communications") %>%
  select(pathway_for_labels_change, estimate, projection)
arts_linked_pathway <- melt(arts_linked_pathway, id = "pathway_for_labels_change")

ggplot(arts_linked_pathway, aes(pathway_for_labels_change, value, fill =variable)) +
  geom_bar(stat="identity",position="dodge") +
  ylab("Number of Jobs") +
  theme(legend.title = element_blank(),
        axis.title.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank()) +
  scale_fill_manual(values = my_colors2,
                    labels = jobs_labels) +
  geom_text(aes(label = value), size = text_size, position = position_dodge(width=text_width), vjust = text_vertical)

# Business Management and Administration

business_linked_pathway <- nonduplicated %>%
  filter(!is.na(pathway), is.na(soc_title),cluster == "Business Management and Administration") %>%
  select(pathway_for_labels_change, estimate, projection)
business_linked_pathway <- melt(business_linked_pathway, id = "pathway_for_labels_change")

ggplot(business_linked_pathway, aes(pathway_for_labels_change, value, fill =variable)) +
  geom_bar(stat="identity",position="dodge") +
  ylab("Number of Jobs") +
  theme(legend.title = element_blank(),
        axis.title.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank()) +
  scale_fill_manual(values = my_colors2,
                    labels = jobs_labels) +
  geom_text(aes(label = value), size = text_size, position = position_dodge(width=text_width), vjust = text_vertical)

# Education and Training

edu_linked_pathway <- nonduplicated %>%
  filter(!is.na(pathway), is.na(soc_title),cluster == "Education and Training") %>%
  select(pathway_for_labels_change, estimate, projection)
edu_linked_pathway <- melt(edu_linked_pathway, id = "pathway_for_labels_change")

ggplot(edu_linked_pathway, aes(pathway_for_labels_change, value, fill =variable)) +
  geom_bar(stat="identity",position="dodge") +
  ylab("Number of Jobs") +
  theme(legend.title = element_blank(),
        axis.title.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank()) +
  scale_fill_manual(values = my_colors2,
                    labels = jobs_labels) +
  geom_text(aes(label = value), size = text_size, position = position_dodge(width=text_width), vjust = text_vertical)

# Finance

finance_linked_pathway <- nonduplicated %>%
  filter(!is.na(pathway),is.na(soc_title), cluster == "Finance") %>%
  select(pathway_for_labels_change, estimate, projection)
finance_linked_pathway <- melt(finance_linked_pathway, id = "pathway_for_labels_change")

ggplot(finance_linked_pathway, aes(pathway_for_labels_change, value, fill =variable)) +
  geom_bar(stat="identity",position="dodge") +
  ylab("Number of Jobs") +
  theme(legend.title = element_blank(),
        axis.title.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank()) +
  scale_fill_manual(values = my_colors2,
                    labels = jobs_labels) +
  geom_text(aes(label = value), size = text_size, position = position_dodge(width=text_width), vjust = text_vertical)

# Government and Public Administration

gov_linked_pathway <- nonduplicated %>%
  filter(!is.na(pathway),is.na(soc_title), !is.na(estimate), cluster == "Government and Public Adminstration") %>%
  select(pathway_for_labels_change, estimate, projection)
gov_linked_pathway <- melt(gov_linked_pathway, id = "pathway_for_labels_change")

ggplot(gov_linked_pathway, aes(pathway_for_labels_change, value, fill =variable)) +
  geom_bar(stat="identity",position="dodge") +
  ylab("Number of Jobs") +
  theme(legend.title = element_blank(),
        axis.title.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank()) +
  scale_fill_manual(values = my_colors2,
                    labels = jobs_labels) +
  geom_text(aes(label = value), size = text_size, position = position_dodge(width=text_width), vjust = text_vertical)

# Health Science

health_linked_pathway <- nonduplicated %>%
  filter(!is.na(pathway),is.na(soc_title), cluster == "Health Science") %>%
  select(pathway_for_labels_change, estimate, projection)
health_linked_pathway <- melt(health_linked_pathway, id = "pathway_for_labels_change")

ggplot(health_linked_pathway, aes(pathway_for_labels_change, value, fill =variable)) +
  geom_bar(stat="identity",position="dodge") +
  ylab("Number of Jobs") +
  theme(legend.title = element_blank(),
        axis.title.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank()) +
  scale_fill_manual(values = my_colors2,
                    labels = jobs_labels) +
  geom_text(aes(label = value), size = text_size, position = position_dodge(width=text_width), vjust = text_vertical)

# Hospitality and Tourism

hosp_linked_pathway <- nonduplicated %>%
  filter(!is.na(pathway),is.na(soc_title), !is.na(estimate), cluster == "Hospitality and Tourism") %>%
  select(pathway_for_labels_change, estimate, projection)
hosp_linked_pathway <- melt(hosp_linked_pathway, id = "pathway_for_labels_change")

ggplot(hosp_linked_pathway, aes(pathway_for_labels_change, value, fill =variable)) +
  geom_bar(stat="identity",position="dodge") +
  ylab("Number of Jobs") +
  theme(legend.title = element_blank(),
        axis.title.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank()) +
  scale_fill_manual(values = my_colors2,
                    labels = jobs_labels) +
  geom_text(aes(label = value), size = text_size, position = position_dodge(width=text_width), vjust = text_vertical)

# Human Services

humanserv_linked_pathway <- nonduplicated %>%
  filter(!is.na(pathway), is.na(soc_title), !is.na(estimate), cluster == "Human Services") %>%
  select(pathway_for_labels_change, estimate, projection)
humanserv_linked_pathway <- melt(humanserv_linked_pathway, id = "pathway_for_labels_change")

ggplot(humanserv_linked_pathway, aes(pathway_for_labels_change, value, fill =variable)) +
  geom_bar(stat="identity",position="dodge") +
  ylab("Number of Jobs") +
  theme(legend.title = element_blank(),
        axis.title.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank()) +
  scale_fill_manual(values = my_colors2,
                    labels = jobs_labels) +
  geom_text(aes(label = value), size = text_size, position = position_dodge(width=text_width), vjust = text_vertical)

# Information Technology

it_linked_pathway <- nonduplicated %>%
  filter(!is.na(pathway), is.na(soc_title), !is.na(estimate), cluster == "Information Technology") %>%
  select(pathway_for_labels_change, estimate, projection)
it_linked_pathway <- melt(it_linked_pathway, id = "pathway_for_labels_change")

ggplot(it_linked_pathway, aes(pathway_for_labels_change, value, fill =variable)) +
  geom_bar(stat="identity",position="dodge") +
  ylab("Number of Jobs") +
  theme(legend.title = element_blank(),
        axis.title.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank()) +
  scale_fill_manual(values = my_colors2,
                    labels = jobs_labels) +
  geom_text(aes(label = value), size = text_size, position = position_dodge(width=text_width), vjust = text_vertical)

# Law, Public Safety, Corrections, and Security

law_linked_pathway <- nonduplicated %>%
  filter(!is.na(pathway),is.na(soc_title), !is.na(estimate), cluster == "Law, Public Safety, Corrections, and Security") %>%
  select(pathway_for_labels_change, estimate, projection)
law_linked_pathway <- melt(law_linked_pathway, id = "pathway_for_labels_change")

ggplot(law_linked_pathway, aes(pathway_for_labels_change, value, fill =variable)) +
  geom_bar(stat="identity",position="dodge") +
  ylab("Number of Jobs") +
  theme(legend.title = element_blank(),
        axis.title.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank()) +
  scale_fill_manual(values = my_colors2,
                    labels = jobs_labels) +
  geom_text(aes(label = value), size = text_size, position = position_dodge(width=text_width), vjust = text_vertical)

# Manufacturing

manufacturing_linked_pathway <- nonduplicated %>%
  filter(!is.na(pathway),is.na(soc_title), !is.na(estimate), cluster == "Manufacturing") %>%
  select(pathway_for_labels_change, estimate, projection)
manufacturing_linked_pathway <- melt(manufacturing_linked_pathway, id = "pathway_for_labels_change")

ggplot(manufacturing_linked_pathway, aes(pathway_for_labels_change, value, fill =variable)) +
  geom_bar(stat="identity",position="dodge") +
  ylab("Number of Jobs") +
  theme(legend.title = element_blank(),
        axis.title.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank()) +
  scale_fill_manual(values = my_colors2,
                    labels = jobs_labels) +
  geom_text(aes(label = value), size = text_size, position = position_dodge(width=text_width), vjust = text_vertical)

# Marketing

marketing_linked_pathway <- nonduplicated %>%
  filter(!is.na(pathway),is.na(soc_title), !is.na(estimate), !is.na(projection), cluster == "Marketing") %>%
  select(pathway_for_labels_change, estimate, projection)
marketing_linked_pathway <- melt(marketing_linked_pathway, id = "pathway_for_labels_change")

ggplot(marketing_linked_pathway, aes(pathway_for_labels_change, value, fill =variable)) +
  geom_bar(stat="identity",position="dodge") +
  ylab("Number of Jobs") +
  theme(legend.title = element_blank(),
        axis.title.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank()) +
  scale_fill_manual(values = my_colors2,
                    labels = jobs_labels) +
  geom_text(aes(label = value), size = text_size, position = position_dodge(width=text_width), vjust = text_vertical)

# Science, Technology, Engineering, and Mathematics

stem_linked_pathway <- nonduplicated %>%
  filter(!is.na(pathway), is.na(soc_title), !is.na(estimate), !is.na(projection), cluster == "Science, Technology, Engineering, and Mathematics") %>%
  select(pathway_for_labels_change, estimate, projection)
stem_linked_pathway <- melt(stem_linked_pathway, id = "pathway_for_labels_change")

ggplot(stem_linked_pathway, aes(pathway_for_labels_change, value, fill =variable)) +
  geom_bar(stat="identity",position="dodge") +
  ylab("Number of Jobs") +
  theme(legend.title = element_blank(),
        axis.title.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank()) +
  scale_fill_manual(values = my_colors2,
                    labels = jobs_labels) +
  geom_text(aes(label = value), size = text_size, position = position_dodge(width=text_width), vjust = text_vertical)

# Transportation, Distribution, and Logistics

transport_linked_pathway <- nonduplicated %>%
  filter(!is.na(pathway), is.na(soc_title), !is.na(estimate), !is.na(projection), cluster == "Transportation, Distribution, and Logistics") %>%
  select(pathway_for_labels_change, estimate, projection)
transport_linked_pathway <- melt(transport_linked_pathway, id = "pathway_for_labels_change")

ggplot(transport_linked_pathway, aes(pathway_for_labels_change, value, fill =variable)) +
  geom_bar(stat="identity",position="dodge") +
  ylab("Number of Jobs") +
  theme(legend.title = element_blank(),
        axis.title.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank()) +
  scale_fill_manual(values = my_colors2,
                    labels = jobs_labels) +
  geom_text(aes(label = value), size = text_size, position = position_dodge(width=text_width), vjust = text_vertical)

# Energy

energy_linked_pathway <- nonduplicated %>%
  filter(!is.na(pathway), is.na(soc_title), !is.na(estimate), !is.na(projection), cluster == "Energy") %>%
  select(pathway_for_labels_change, estimate, projection)
energy_linked_pathway <- melt(energy_linked_pathway, id = "pathway_for_labels_change")

ggplot(energy_linked_pathway, aes(pathway_for_labels_change, value, fill =variable)) +
  geom_bar(stat="identity",position="dodge") +
  ylab("Number of Jobs") +
  theme(legend.title = element_blank(),
        axis.title.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank()) +
  scale_fill_manual(values = my_colors2,
                    labels = jobs_labels)  +
  geom_text(aes(label = value), size = text_size, position = position_dodge(width=text_width), vjust = text_vertical)


##Different Visualization
nonduplicated %>% filter(cluster == "Agriculture, Food, and Natural Resources", !is.na(pathway), is.na(soc_title)) %>% ggplot(aes(pathway_for_labels, fraction_change)) + geom_segment( aes(x=pathway_for_labels, xend= pathway_for_labels, y=0, yend=fraction_change), color="grey") +
  geom_point( color="orange", size=4)
  
```

```{r 3rd graph showing income, openings, and growth}

nonduplicated %>% filter(cluster == "Agriculture, Food, and Natural Resources", !is.na(pathway), is.na(soc_title)) %>% ggplot(aes(estimate, fraction_change, color = pathway, size = annual_openings)) + geom_point()

nonduplicated %>% filter(cluster == "Agriculture, Food, and Natural Resources", !is.na(pathway), !is.na(median_income)) %>%  ggplot(aes(median_income, fraction_change)) + geom_hex()

nonduplicated %>% filter(cluster == "Agriculture, Food, and Natural Resources", !is.na(pathway)) %>% ggplot(aes(pathway_for_labels, median_income)) + geom_violin()

nonduplicated %>% filter(cluster == "Agriculture, Food, and Natural Resources", !is.na(pathway)) %>% ggplot(aes( median_income, pathway_for_labels, fill = pathway_for_labels)) + geom_density_ridges() + theme_ridges() 
```

